---
import dayjs from "dayjs";
import { Config } from "~/config";
export interface Props {
  title?: string;
  description?: string;
  snapshot?: string;
  path?: string;
  pubDate?: string;
}

const {
  title = Config.base.title,
  description = Config.base.description,
  snapshot,
  path,
  pubDate,
} = Astro.props;

const articleTimeFormat = pubDate ? dayjs(pubDate).format("YYYY-MM-DD") : null;
const baseUrl = Config.base.baseUrl;
const ogImageUrl = snapshot ? `${baseUrl}/post/${snapshot}/index.png` : null;
const fullUrl = path ? `${baseUrl}${path}` : baseUrl;

// 针对不同类型内容优化 og:type 值
const ogType = pubDate ? "article" : "website";
---

<link rel="sitemap" href="/sitemap-index.xml" />
<title>{title}</title>
{description && <meta name="description" content={description} />}

<!-- 规范链接，避免重复内容 -->
<link rel="canonical" href={fullUrl} />

<!-- Open Graph Tags -->
<meta property="og:title" content={title} />
<meta property="og:type" content={ogType} />
{description && <meta property="og:description" content={description} />}

{/* URL and Site Info */}
<meta property="og:site_name" content={Config.base.title} />
<meta property="og:url" content={fullUrl} />

{/* OpenGraph Image */}
{ogImageUrl && (
  <>
    <meta property="og:image" content={ogImageUrl} />
    {description && <meta property="og:image:alt" content={description} />}
  </>
)}

<!-- Twitter Tags -->
<meta name="twitter:title" content={title} />
{description && <meta name="twitter:description" content={description} />}
{ogImageUrl && (
  <>
    <meta name="twitter:image" content={ogImageUrl} />
    <meta name="twitter:card" content="summary_large_image" />
  </>
)}

<!-- Article Metadata -->
<meta property="article:author" content={Config.base.author} />
{articleTimeFormat && (
  <>
    <meta property="article:published_time" content={articleTimeFormat} />
    <meta property="article:modified_time" content={articleTimeFormat} />
  </>
)}

<!-- 附加SEO优化标签 -->
<meta name="robots" content="index, follow" />
<meta name="language" content="Chinese" />
<meta name="revisit-after" content="7 days" />
<meta name="author" content={Config.base.author} />

<!-- 移动设备优化 -->
<meta name="format-detection" content="telephone=no" />
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
